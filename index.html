<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSA 9 · PSA 10 · CGC 10 | EN + JP</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; margin: 0; padding: 2rem; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; text-align: center; }
        .header h1 { margin: 0; font-size: 2rem; }
        .search-box { padding: 2rem; border-bottom: 1px solid #eee; display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; }
        #searchInput { flex: 1; min-width: 280px; padding: 1rem 1.5rem; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 50px; outline: none; }
        #searchInput:focus { border-color: #667eea; box-shadow: 0 0 0 4px rgba(102,126,234,0.1); }
        .toggle-group { display: flex; background: #f1f3f5; border-radius: 50px; padding: 4px; gap: 4px; }
        .toggle-btn { padding: 0.7rem 1.2rem; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; min-width: 80px; }
        .toggle-btn.active { color: white; }
        .grade-psa10.active { background: #28a745; }
        .grade-psa9.active  { background: #dc3545; }
        .grade-cgc10.active { background: #1a73e8; }
        .lang-en.active  { background: #007bff; }
        .lang-jp.active  { background: #d32f2f; }
        .results { max-height: 650px; overflow-y: auto; }
        .item { padding: 1.5rem 2rem; border-bottom: 1px solid #f0f0f0; }
        .item:hover { background: #f8f9ff; }
        .no-results { text-align: center; padding: 3rem; color: #888; font-style: italic; }
        .highlight { background: #fff3cd; padding: 0.1em 0.2em; border-radius: 3px; }
        .name { font-weight: bold; font-size: 1.2rem; margin-bottom: 0.5rem; }
        .year-title { font-weight: 600; color: #333; margin: 0.8rem 0 0.4rem; }
        .card-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .card {
            background: #e8f4fd; padding: 0.3rem 0.6rem; border-radius: 6px;
            font-size: 0.85rem; font-family: monospace; text-decoration: none; color: inherit;
            display: inline-block; transition: all 0.2s;
        }
        .card:hover { background: #d0e8ff; transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card-value { color: #007bff; font-weight: bold; }
        .card-value::after { content: " (PSA 10)"; font-size: 0.65rem; color: #28a745; font-weight: bold; margin-left: 4px; }
        body.psa9  .card-value::after { content: " (PSA 9)";  color: #dc3545; }
        body.cgc10 .card-value::after { content: " (CGC 10)"; color: #1a73e8; }
        body.jp    .card-value::after { content: " (JP)"; color: #d32f2f; font-size: 0.6rem; }
        .footer { text-align: center; padding: 1rem; background: #f9f9f9; border-top: 1px solid #eee; color: #666; font-size: 0.9rem; }
        .setup { text-align: center; padding: 4rem 2rem; }
        .setup button { padding: 16px 32px; background: #667eea; color: white; border: none; border-radius: 12px; font-size: 1.2rem; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PSA 9 · PSA 10 · CGC 10 | EN + JP</h1>
            <p>Click any card → eBay sold listings</p>
        </div>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Type name (e.g. Mew) or name + year (e.g. Mew 2024)" autocomplete="off" />

            <div class="toggle-group">
                <button class="toggle-btn lang-en active" data-lang="en">EN</button>
                <button class="toggle-btn lang-jp" data-lang="jp">JP</button>
            </div>

            <div class="toggle-group">
                <button class="toggle-btn grade-psa10 active" data-grade="10">PSA 10</button>
                <button class="toggle-btn grade-psa9" data-grade="9">PSA 9</button>
                <button class="toggle-btn grade-cgc10" data-grade="cgc">CGC 10</button>
            </div>
        </div>

        <div class="results" id="results"></div>
        <div class="footer" id="status">Loading data...</div>
    </div>

    <script>
        const data = { en: { psa10: {}, psa9: {}, cgc10: {} }, jp: { psa10: {}, psa9: {}, cgc10: {} } };
        let currentLang = 'en', currentGrade = '10', currentData = {};
        let nameQuery = '';

        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');
        const searchInput = document.getElementById('searchInput');

        const FILES = {
            en: { '10': 'PSA10.json', '9': 'PSA9.json', 'cgc': 'CGC10.json' },
            jp: { '10': 'PSA10_JP.json', '9': 'PSA9_JP.json', 'cgc': 'CGC10_JP.json' }
        };

        async function tryAutoLoad() {
            let loaded = 0;
            for (const lang of ['en', 'jp']) {
                for (const [g, file] of Object.entries(FILES[lang])) {
                    try {
                        const r = await fetch(file + '?t=' + Date.now(), { cache: 'no-store' });
                        if (r.ok) {
                            const text = (await r.text()).replace(/^\uFEFF/, '').trim();
                            const key = g === '10' ? 'psa10' : g === '9' ? 'psa9' : 'cgc10';
                            data[lang][key] = JSON.parse(text);
                            loaded++;
                        }
                    } catch (e) {}
                }
            }
            return loaded >= 3;
        }

        function showManualLoad() {
            resultsDiv.innerHTML = `
                <div class="setup">
                    <h3>Click to load your 6 JSON files</h3>
                    <p>(Only once per browser)</p>
                    <button onclick="pickFiles()">Load Files Manually</button>
                </div>`;
            statusDiv.textContent = 'Manual load required';
        }

        window.pickFiles = () => {
            const input = document.createElement('input');
            input.type = 'file'; input.accept = '.json'; input.multiple = true;
            input.onchange = e => {
                Array.from(e.target.files).forEach(f => {
                    const r = new FileReader();
                    r.onload = ev => {
                        try {
                            const json = JSON.parse(ev.target.result.replace(/^\uFEFF/, '').trim());
                            const n = f.name.toLowerCase();
                            if (n.includes('jp')) {
                                if (n.includes('psa10')) data.jp.psa10 = json;
                                else if (n.includes('psa9')) data.jp.psa9 = json;
                                else if (n.includes('cgc10')) data.jp.cgc10 = json;
                            } else {
                                if (n.includes('psa10') || n.includes('clean')) data.en.psa10 = json;
                                else if (n.includes('psa9')) data.en.psa9 = json;
                                else if (n.includes('cgc10')) data.en.cgc10 = json;
                            }
                        } catch (err) { console.error(err); }
                    };
                    r.readAsText(f);
                });
            };
            input.click();
        };

        function updateData() {
            const key = currentGrade === '10' ? 'psa10' : currentGrade === '9' ? 'psa9' : 'cgc10';
            currentData = data[currentLang][key] || {};
            document.body.className = currentLang === 'jp' ? 'jp' : '';
            if (currentGrade === '9') document.body.classList.add('psa9');
            if (currentGrade === 'cgc') document.body.classList.add('cgc10');
            search();
        }

        function getGradeText() {
            return currentGrade === '10' ? 'PSA 10' : currentGrade === '9' ? 'PSA 9' : 'CGC 10';
        }

        function formatCard(code, value, name, year) {
            const clean = code.replace(/^#/, '').trim();
            const lang = currentLang === 'jp' ? 'Japanese' : '';
            const terms = [name, year, clean, getGradeText(), lang].filter(Boolean).join(' ');
            const url = `https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(terms)}&LH_Sold=1&LH_Complete=1`;
            return `<a href="${url}" target="_blank" class="card">${code}: <span class="card-value">$${value}</span><span style="margin-left:4px;font-size:0.7rem;opacity:0.7;color:#0064d5;">eBay</span></a>`;
        }

        function renderPokemon(name, path) {
            let html = `<div class="name">${highlight(name)}</div>`;
            Object.keys(path).forEach(year => {
                const cards = path[year];
                let cardHtml = '';
                Object.keys(cards).forEach(code => {
                    cardHtml += formatCard(code, cards[code], name, year);
                });
                if (cardHtml) {
                    html += `<div class="year-section"><div class="year-title">${year}</div><div class="card-list">${cardHtml}</div></div>`;
                }
            });
            return html;
        }

        function renderYearOnly(name, year, cards) {
            let html = `<div class="name">${highlight(name)} - ${year}</div><div class="card-list">`;
            Object.keys(cards).forEach(code => {
                html += formatCard(code, cards[code], name, year);
            });
            return html + '</div>';
        }

        function search() {
            const query = searchInput.value.trim();
            resultsDiv.innerHTML = '';

            if (!query) {
                resultsDiv.innerHTML = '<div class="no-results">Start typing a Pokémon name...</div>';
                nameQuery = '';
                return;
            }

            if (Object.keys(currentData).length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">Loading data...</div>';
                return;
            }

            const parts = query.toLowerCase().split(/\s+/).filter(p => p);
            nameQuery = parts[0];
            const yearQuery = parts.length > 1 ? parts.slice(1).join(' ') : '';

            const matches = Object.keys(currentData)
                .filter(name => name.toLowerCase().includes(nameQuery))
                .slice(0, 20);

            if (!matches.length) {
                resultsDiv.innerHTML = '<div class="no-results">No Pokémon found</div>';
                return;
            }

            matches.forEach(name => {
                const path = currentData[name];
                const div = document.createElement('div');
                div.className = 'item';

                if (yearQuery && path[yearQuery]) {
                    div.innerHTML = renderYearOnly(name, yearQuery, path[yearQuery]);
                } else {
                    div.innerHTML = renderPokemon(name, path);
                }
                resultsDiv.appendChild(div);
            });
        }

        function highlight(text) {
            if (!nameQuery) return text;
            const regex = new RegExp(`(${nameQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        searchInput.addEventListener('input', search);

        document.querySelectorAll('[data-lang]').forEach(b => b.onclick = () => {
            document.querySelectorAll('[data-lang]').forEach(x => x.classList.remove('active'));
            b.classList.add('active');
            currentLang = b.dataset.lang;
            updateData();
        });

        document.querySelectorAll('[data-grade]').forEach(b => b.onclick = () => {
            document.querySelectorAll('[data-grade]').forEach(x => x.classList.remove('active'));
            b.classList.add('active');
            currentGrade = b.dataset.grade;
            updateData();
        });

        (async () => {
            const success = await tryAutoLoad();
            if (success && Object.keys(data.en.psa10).length && Object.keys(data.jp.psa10).length) {
                updateData();
                statusDiv.textContent = 'Ready — type any Pokémon name';
            } else {
                showManualLoad();
            }
        })();
    </script>
</body>
</html>
